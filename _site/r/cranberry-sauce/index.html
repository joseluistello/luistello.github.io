<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>The 'circular random walk' puzzle: tidy simulation of stochastic processes in R &#8211; Simplificando la complejidad</title>
<meta name="description" content="Previously in this series
">
<meta name="keywords" content="r, statistics">


<!-- Twitter Cards -->
<meta name="twitter:title" content="The 'circular random walk' puzzle: tidy simulation of stochastic processes in R">
<meta name="twitter:description" content="Previously in this series
">
<meta name="twitter:site" content="@jotaele_tello">
<meta name="twitter:creator" content="@jotaele_tello">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="The 'circular random walk' puzzle: tidy simulation of stochastic processes in R">
<meta property="og:description" content="Previously in this series
">
<meta property="og:url" content="http://localhost:4000/r/cranberry-sauce/">
<meta property="og:site_name" content="Simplificando la complejidad">





<link rel="canonical" href="http://localhost:4000/r/cranberry-sauce/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Simplificando la complejidad Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- MathJax -->
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57723549-1', 'auto');
  ga('send', 'pageview');
</script>



</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://localhost:4000">Simplificando la complejidad</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
					    
					    <li><a href="http://localhost:4000/about/" >About Me</a></li>
					  
					    
					    <li><a href="http://localhost:4000/posts/" >Portfolio</a></li>
					  
					    
					    <li><a href="https://joseluistello.substack.com/" target="_blank">Library</a></li>
					  
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    


	<img src="http://localhost:4000/images/joseluistello.jpg" class="bio-photo" alt="José Luis Tello bio photo">

<h3>José Luis Tello</h3>
<p>Data analyst, finance & business strategy.</p>
<a href="mailto:joluistello@gmail.com" class="author-social" target="_blank"><i class="fa fa-envelope-square"></i> Email</a>
<a href="http://twitter.com/jotaele_tello" class="author-social" target="_blank"><i class="fa fa-twitter-square"></i> Twitter</a>





<a href="http://github.com/joseluistello" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>








<style type="text/css"> 
.styled-button-4 {
	-webkit-box-shadow:rgba(0,0,0,0.98) 0 1px 0 0;
	-moz-box-shadow:rgba(0,0,0,0.98) 0 1px 0 0;
	box-shadow:rgba(0,0,0,0.98) 0 1px 0 0;
	background-color:#EEE;
	border-radius:0;
	-webkit-border-radius:0;
	-moz-border-radius:0;
	border:1px solid #999;
	color:#666;
	font-family:'Lucida Grande',Tahoma,Verdana,Arial,Sans-serif;
	font-size:11px;
	font-weight:700;
	padding:2px 6px;
	height:28px
}
</style>


<h4>Recomendaciones</h4>
<ul>
    <li><a href="https://www.youtube.com/channel/UC8KCb358oioQMcJ5pUfs8UQ">Antonio Feregrino - Machine Learning</a></li>
    <li><a href="https://www.youtube.com/channel/UClMCc-ACtQ9gJ5BRlHZkTKQ">Carlos Haro - Ciencia de datos</a></li>
    <li><a href="http://varianceexplained.org/">David Robinson - Ciencia de datos </a></li>
    <li><a href="https://www.youtube.com/channel/UCTTBgWyJl2HrrhQOOc710kA">Julia Silge - Ciencia de datos</a></li>

</ul>
  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="http://localhost:4000/r/cranberry-sauce/" rel="bookmark" title="The 'circular random walk' puzzle: tidy simulation of stochastic processes in R">The 'circular random walk' puzzle: tidy simulation of stochastic processes in R</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p><strong>Previously in this series</strong></p>

<ul>
  <li><a href="http://varianceexplained.org/r/boarding-pass-simulation/">The “lost boarding pass” puzzle</a></li>
  <li><a href="http://varianceexplained.org/r/board-game-simulation/">The “deadly board game” puzzle</a></li>
  <li><a href="http://varianceexplained.org/r/knight-chess/">The “knight on an infinite chessboard” puzzle</a></li>
  <li><a href="http://varianceexplained.org/r/stock-changes/">The “largest stock profit or loss” puzzle</a></li>
  <li><a href="http://varianceexplained.org/r/birthday-problem/">The “birthday paradox” puzzle</a></li>
  <li><a href="http://varianceexplained.org/r/honeycomb-puzzle/">The “Spelling Bee honeycomb” puzzle</a></li>
  <li><a href="http://varianceexplained.org/r/feller-coins/">Feller’s “coin-tossing” puzzle</a></li>
  <li><a href="http://varianceexplained.org/r/spam-simulation/">The “spam comments” puzzle</a></li>
  <li><a href="http://varianceexplained.org/r/riddler-prisoner-flip/">The “prisoner coin flipping” puzzle</a></li>
</ul>

<p>I love 538’s Riddler column, and I’ve enjoyed solving <a href="https://fivethirtyeight.com/features/can-you-pass-the-cranberry-sauce/">the November 20th puzzle</a>. I’ll quote:</p>

<blockquote>
  <p>To celebrate Thanksgiving, you and 19 of your family members are seated at a circular table (socially distanced, of course). Everyone at the table would like a helping of cranberry sauce, which happens to be in front of you at the moment.</p>
</blockquote>

<blockquote>
  <p>Instead of passing the sauce around in a circle, you pass it randomly to the person seated directly to your left or to your right. They then do the same, passing it randomly either to the person to their left or right. This continues until everyone has, at some point, received the cranberry sauce.</p>
</blockquote>

<blockquote>
  <p>Of the 20 people in the circle, who has the greatest chance of being the last to receive the cranberry sauce?</p>
</blockquote>

<p>I’ll solve this with tidy simulation in R, as usual using one of my favorite functions, tidyr’s <code class="highlighter-rouge">crossing()</code>, and getting another chance to explore a variation of a “random walk”.</p>

<h3 id="simulating-a-table-of-20">Simulating a table of 20</h3>

<p>What’s fun about this problem is that it’s an example of a <a href="https://en.wikipedia.org/wiki/Random_walk">random walk</a>: a stochastic process made up of a sequence of random steps (in this case, left or right). What makes this a fun variation is that it’s a random walk in a circle- passing 5 to the left is the same as passing 15 to the right. I wasn’t previously familiar with a random walk in a circle, so I approached it through simulation to learn about its properties.</p>

<h4 id="simulating-a-random-walk-in-a-circle">Simulating a random walk in a circle</h4>

<p>The classic way to simulate a random walk in R is with <code class="highlighter-rouge">cumsum()</code> and <code class="highlighter-rouge">sample()</code>. <code class="highlighter-rouge">sample(c(1, -1))</code> picks a random direction for each step, and <code class="highlighter-rouge">cumsum()</code> takes the cumulative sum of those steps:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="nf">cumsum</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">),</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##  [1] 1 2 3 4 5 6 7 6 5 6 5 6 5 6 7 6 5 6 7 6 5 6 5 4 5 4 3 4 5 4</code></pre></figure>

<p>Right now this is a random walk on integers (…, -2, -1, 0, 1, 2, …). To make this a random walk at a circular table of 20, you can use the <a href="https://en.wikipedia.org/wiki/Modular_arithmetic">modulo operator</a>, <code class="highlighter-rouge">%% 20</code>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="nf">cumsum</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">),</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="m">20</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##  [1]  1  0 19 18 17 16 17 18 19 18 19 18 19 18 17 18 19  0 19  0 19  0  1  2  1  2  3
## [28]  4  5  4</code></pre></figure>

<p>Notice that the cranberry sauce can now be passed from 0 to 19 and then back.</p>

<h4 id="simulating-many-walks-with-crossing">Simulating many walks with crossing()</h4>

<p>We’ll simulate 50,000 trials (feel free to increase or decrease that number, depending on how accurate you need your simulation to be). For each, we’ll try 1000 steps.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">

</span><span class="c1"># For the sake of efficiency, perform only the cumulative sum</span><span class="w">
</span><span class="c1"># as a grouped operation</span><span class="w">
</span><span class="n">sim_steps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">crossing</span><span class="p">(</span><span class="n">trial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">50000</span><span class="p">,</span><span class="w">
                      </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="p">(),</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cumsum</span><span class="p">(</span><span class="n">direction</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">seat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w">

</span><span class="n">sim_steps</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 50,000,000 x 5
##    trial  step direction position  seat
##    &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1         1        1     1
##  2     1     2        -1        0     0
##  3     1     3        -1       -1    19
##  4     1     4         1        0     0
##  5     1     5        -1       -1    19
##  6     1     6         1        0     0
##  7     1     7        -1       -1    19
##  8     1     8         1        0     0
##  9     1     9         1        1     1
## 10     1    10         1        2     2
## # … with 49,999,990 more rows</code></pre></figure>

<p>We end up with 10 million steps, each representing the position of the cranberry sauce at one point in time.</p>

<p>How long does it take for the cranberry sauce to reach each seat for the <em>first</em> time? We can use <code class="highlighter-rouge">distinct()</code> with <code class="highlighter-rouge">.keep_all = TRUE</code> to answer that: we keep the first time each seat appears in each trial. (We also filter out seat 0, which is you, because you <em>start</em> with the cranberry sauce on step 0).</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim_steps</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">distinct</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span><span class="w"> </span><span class="n">seat</span><span class="p">,</span><span class="w"> </span><span class="n">.keep_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">seat</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">

</span><span class="n">sim</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 949,995 x 5
##    trial  step direction position  seat
##    &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1         1        1     1
##  2     1     3        -1       -1    19
##  3     1    10         1        2     2
##  4     1    14        -1       -2    18
##  5     1    43        -1       -3    17
##  6     1    50        -1       -4    16
##  7     1    63        -1       -5    15
##  8     1    64        -1       -6    14
##  9     1    65        -1       -7    13
## 10     1    66        -1       -8    12
## # … with 949,985 more rows</code></pre></figure>

<h4 id="summarizing-and-visualizing">Summarizing and visualizing</h4>

<p>Now that we have our simulation with one row for each seat in each trial, we can learn stats about each seat. Which is the best seat to be in? Which is most likely to be last?</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">by_seat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">is_last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row_number</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">seat</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">avg_step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">step</span><span class="p">),</span><span class="w">
            </span><span class="n">pct_last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">is_last</span><span class="p">),</span><span class="w">
            </span><span class="n">avg_length_last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">step</span><span class="p">[</span><span class="n">is_last</span><span class="p">]))</span></code></pre></figure>

<p>This isn’t the Riddler’s question, but it’s the first one I was interested in: how long does it take for each seat, on average, to get the cranberry sauce?</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">by_seat</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">seat</span><span class="p">,</span><span class="w"> </span><span class="n">avg_step</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">expand_limits</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Seat"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Average # of steps to reach this seat"</span><span class="p">)</span></code></pre></figure>

<p><img src="/figs/2020-11-23-cranberry-sauce/unnamed-chunk-5-1.png" alt="center" /></p>

<p>It looks like a parabola. The best seat to be in is either #1 or #19, immediately to the right or left of the starting position: on average they’re waiting about 19 steps to get it. The worst seat to be in is #10, directly across the table. On average they’re waiting about 100 steps to get it. Overall, this makes intuitive sense: the closer you are to the original sauce, the more likely you can get it right away.</p>

<p>What I love about tidy simulation is that I can visualize some more details about the distribution, such as with a histogram on a log scale.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sim</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">step</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_histogram</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_log10</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">seat</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free_y"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Step on which this seat gets the cranberry sauce"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span></code></pre></figure>

<p><img src="/figs/2020-11-23-cranberry-sauce/unnamed-chunk-6-1.png" alt="center" /></p>

<p>The seats immediately to your left and right, 1 and 19, have a mode of 1 step (which makes sense: they have a 50% chance of getting it on the first step). For seats that are roughly across the table (like 7-13), the number of steps looks roughly log-normally distributed.</p>

<p>Now let’s answer the Ridder’s question: how likely is each seat to be the <em>last</em> person to get the cranberry sauce?</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">by_seat</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">seat</span><span class="p">,</span><span class="w"> </span><span class="n">pct_last</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scales</span><span class="o">::</span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">expand_limits</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Seat"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"% this is the last seat to get cranberry sauce"</span><span class="p">)</span></code></pre></figure>

<p><img src="/figs/2020-11-23-cranberry-sauce/unnamed-chunk-7-1.png" alt="center" /></p>

<p>That’s a very different story! Other than a little random noise, the 19 people at the table all have the same probability of being the last to receive the cranberry sauce. (The probability is therefore 1/19, shown by the dashed red line).</p>

<p>This wasn’t what I originally expected, but upon consideration it makes sense. Consider the person at seat 10 (directly across the table from you). We know it will take longer for them to get the sauce, but consider what it would take to be last. Imagine the moment that the sauce first reaches either person 9 or person 11 (one of which has to happen first). At that moment, the situation is analogous. to the person seated immediately to the original left or right: the sauce would have to make a full circle of the table before going just one step. The same would apply to any seat \(s\), by breaking it down into the situation where the sauce reaches either \(s-1\) or \(s+1\).</p>

<h3 id="larger-table-sizes">Larger table sizes</h3>

<p>Something I love about <code class="highlighter-rouge">crossing()</code> for simulation is that you can keep adding complexity to the question you’re asking. What if there weren’t 20 people at the table, but some arbitrary \(n\)? We’ll try 20, 30, and 40, doing 20K simulations each.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Repeat all of the above, but with an extra crossing() step</span><span class="w">
</span><span class="n">sim_size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">crossing</span><span class="p">(</span><span class="n">trial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">20000</span><span class="p">,</span><span class="w">
                           </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="p">(),</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cumsum</span><span class="p">(</span><span class="n">direction</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">crossing</span><span class="p">(</span><span class="n">table_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">seat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="n">table_size</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">distinct</span><span class="p">(</span><span class="n">table_size</span><span class="p">,</span><span class="w"> </span><span class="n">trial</span><span class="p">,</span><span class="w"> </span><span class="n">seat</span><span class="p">,</span><span class="w"> </span><span class="n">.keep_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">seat</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">

</span><span class="c1"># Group by table_size as well</span><span class="w">
</span><span class="n">by_seat_size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim_size</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">table_size</span><span class="p">,</span><span class="w"> </span><span class="n">trial</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">is_last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row_number</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">table_size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">table_size</span><span class="p">,</span><span class="w"> </span><span class="n">seat</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">avg_step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">step</span><span class="p">),</span><span class="w">
            </span><span class="n">pct_last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">is_last</span><span class="p">),</span><span class="w">
            </span><span class="n">avg_length_last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">step</span><span class="p">[</span><span class="n">is_last</span><span class="p">]))</span></code></pre></figure>

<p>We can confirm that the “all seats are equally likely to get the sauce last” holds true for every table size.</p>

<p><img src="/figs/2020-11-23-cranberry-sauce/unnamed-chunk-8-1.png" alt="center" /></p>

<p>But we can also take a closer look at that parabola for the average # of steps to reach each position. Can we figure out a closed form solution for it?</p>

<p><img src="/figs/2020-11-23-cranberry-sauce/unnamed-chunk-9-1.png" alt="center" /></p>

<p>A few patterns we notice, where \(n\) is the table size.</p>

<ul>
  <li>The peak for each is at seat \(n / 2\), which takes on average \((n / 2) ^ 2 steps\).</li>
  <li>The average for seats 1 and \(n-1\) (the people seated immediately to your left/right) is \(n-1\).</li>
</ul>

<p>We can get a bit more precise by fitting a parabola to each of the seat size results, using the <code class="highlighter-rouge">broom</code> package to combine the linear models.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">by_seat_size</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">linear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seat</span><span class="p">,</span><span class="w">
         </span><span class="n">quadratic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seat</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">table_size</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">lm</span><span class="p">(</span><span class="n">avg_step</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">quadratic</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">linear</span><span class="p">)),</span><span class="w">
            </span><span class="n">td</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span><span class="w"> </span><span class="n">broom</span><span class="o">::</span><span class="n">tidy</span><span class="p">,</span><span class="w"> </span><span class="n">conf.int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">unnest</span><span class="p">(</span><span class="n">td</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">table_size</span><span class="p">,</span><span class="w"> </span><span class="n">estimate</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_ribbon</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conf.low</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conf.high</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">term</span><span class="p">)</span></code></pre></figure>

<p><img src="/figs/2020-11-23-cranberry-sauce/unnamed-chunk-10-1.png" alt="center" /></p>

<p>The intercept is indistinguishable from 0, the linear term is equal to the table size, and the quadratic term stays at -1. This suggests that the average number of steps to reach a seat \(s\) is \(-s^2+n*s\). (This matches our results for the maximum and the \(s=1\) point above).</p>

<p>As I often note in these posts, I love how doing some simulation can lead us to an exact solution (even if we can’t yet prove it).</p>

      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          


	<img src="http://localhost:4000/images/joseluistello.jpg" class="bio-photo" alt="José Luis Tello bio photo">

<h3>José Luis Tello</h3>
<p>Data analyst, finance & business strategy.</p>
<a href="mailto:joluistello@gmail.com" class="author-social" target="_blank"><i class="fa fa-envelope-square"></i> Email</a>
<a href="http://twitter.com/jotaele_tello" class="author-social" target="_blank"><i class="fa fa-twitter-square"></i> Twitter</a>





<a href="http://github.com/joseluistello" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>








<style type="text/css"> 
.styled-button-4 {
	-webkit-box-shadow:rgba(0,0,0,0.98) 0 1px 0 0;
	-moz-box-shadow:rgba(0,0,0,0.98) 0 1px 0 0;
	box-shadow:rgba(0,0,0,0.98) 0 1px 0 0;
	background-color:#EEE;
	border-radius:0;
	-webkit-border-radius:0;
	-moz-border-radius:0;
	border:1px solid #999;
	color:#666;
	font-family:'Lucida Grande',Tahoma,Verdana,Arial,Sans-serif;
	font-size:11px;
	font-weight:700;
	padding:2px 6px;
	height:28px
}
</style>


<h4>Recomendaciones</h4>
<ul>
    <li><a href="https://www.youtube.com/channel/UC8KCb358oioQMcJ5pUfs8UQ">Antonio Feregrino - Machine Learning</a></li>
    <li><a href="https://www.youtube.com/channel/UClMCc-ACtQ9gJ5BRlHZkTKQ">Carlos Haro - Ciencia de datos</a></li>
    <li><a href="http://varianceexplained.org/">David Robinson - Ciencia de datos </a></li>
    <li><a href="https://www.youtube.com/channel/UCTTBgWyJl2HrrhQOOc710kA">Julia Silge - Ciencia de datos</a></li>

</ul>
        </div>
        <p class="byline"><strong>The 'circular random walk' puzzle: tidy simulation of stochastic processes in R</strong> was published on <time datetime="2020-11-23T17:40:00-06:00">November 23, 2020</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://localhost:4000/posts/">View all posts</a>)</small></h4>
    <ul>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    

<span>&copy; 2021 José Luis Tello. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'joseluistello'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	        

</body>
</html>